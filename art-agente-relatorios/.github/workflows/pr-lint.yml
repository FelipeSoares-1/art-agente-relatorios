name: PR - Lint Commits

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  commitlint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Validate PR title
        run: |
          title="${{ github.event.pull_request.title }}"
          # Check conventional commit format
          if ! echo "$title" | grep -qE '^(feat|fix|docs|style|refactor|perf|test|chore)(\(.+\))?!?:'; then
            echo "❌ PR title must follow Conventional Commits format"
            echo "Format: <type>(<scope>): <subject>"
            echo "Example: feat(reports): add PDF export"
            exit 1
          fi
          echo "✅ PR title follows Conventional Commits"

      - name: Check branch name
        run: |
          branch="${{ github.head_ref }}"
          if ! echo "$branch" | grep -qE '^(feature|fix|docs|chore)\/'; then
            echo "⚠️ Branch name should follow pattern: feature/, fix/, docs/, chore/"
            echo "Current: $branch"
          fi

  labels:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Require labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels;
            const validLabels = ['bug', 'feature', 'docs', 'refactor', 'dependencies'];
            
            if (labels.length === 0) {
              core.setFailed('Please add at least one label to your PR');
              return;
            }
            
            const hasValidLabel = labels.some(label => 
              validLabels.includes(label.name)
            );
            
            if (!hasValidLabel) {
              core.setFailed(`Please add one of: ${validLabels.join(', ')}`);
            }
